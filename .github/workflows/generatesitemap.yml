name: Auto Generate Sitemap

on:
  push:
    branches:
      - main  # Ganti jika branch utama berbeda

jobs:
  sitemap:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.x"

      - name: Install dependencies
        run: pip install beautifulsoup4

      - name: Generate sitemap.xml
        run: |
          python << 'EOF'
          import os
          from datetime import datetime

          BASE_URL = "https://beny-cyber.github.io/Greentouch-indonesia/"
          SITEMAP_FILE = "sitemap.xml"

          urls = []
          for root, dirs, files in os.walk("."):
              for file in files:
                  if file.endswith(".html"):
                      path = os.path.relpath(os.path.join(root, file), ".").replace("\\", "/")
                      urls.append(path)

          now = datetime.utcnow().strftime("%Y-%m-%d")
          with open(SITEMAP_FILE, "w", encoding="utf-8") as f:
              f.write('<?xml version="1.0" encoding="UTF-8"?>\n')
              f.write('<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">\n')
              for url in urls:
                  loc = BASE_URL + url
                  f.write("  <url>\n")
                  f.write(f"    <loc>{loc}</loc>\n")
                  f.write(f"    <lastmod>{now}</lastmod>\n")
                  f.write("    <changefreq>weekly</changefreq>\n")
                  f.write("    <priority>0.8</priority>\n")
                  f.write("  </url>\n")
              f.write("</urlset>\n")
          EOF

      - name: Commit and push sitemap
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          git add sitemap.xml
          git commit -m "Update sitemap [skip ci]" || echo "No changes"
          git push
          
